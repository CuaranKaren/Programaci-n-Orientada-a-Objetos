from modelo import CriticalThresholdError


class Controlador:
    def __init__(self, sensor, vista, notificador):
        self.sensor = sensor
        self.vista = vista
        self.notificador = notificador
        self.umbral = 28

    def ejecutar(self):
        try:
            temperatura, humedad = self.sensor.leer_datos()
            self.vista.mostrar_datos(temperatura, humedad)

            if temperatura > self.umbral:
                raise CriticalThresholdError(
                    f"""üö® ALERTA DEL SISTEMA IoT

Temperatura cr√≠tica detectada: {temperatura} ¬∞C
Umbral permitido: {self.umbral} ¬∞C

Acciones realizadas:
- Activaci√≥n de LED rojo
- Notificaci√≥n enviada por Telegram
"""
                )

            self.vista.led_verde()

        except CriticalThresholdError as e:
            self.vista.led_rojo()
            self.notificador.enviar_alerta(str(e))

        except Exception as e:
            print("‚ùå Error:", e)
